<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Memorization App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            text-align: center;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            resize: vertical;
        }

        .controls {
            margin: 20px 0;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .mode-toggle {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #e8f4f8;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background-color: #ccc;
            border-radius: 15px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .toggle-switch.active {
            background-color: #4CAF50;
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }

        .mode-label {
            font-weight: bold;
            color: #555;
        }

        .mode-description {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .slider-container {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #555;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
            border-radius: 5px;
        }

        input[type="range"]:hover {
            opacity: 1;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #4CAF50;
            cursor: pointer;
            border-radius: 50%;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #4CAF50;
            cursor: pointer;
            border-radius: 50%;
        }

        .percentage {
            text-align: center;
            font-size: 18px;
            color: #4CAF50;
            margin-top: 10px;
        }

        button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s;
            margin-bottom: 10px;
        }

        button:hover {
            background-color: #1976D2;
        }

        .randomize:active {
            background-color: #125191 !important;
        }
        .check-button:active {
            background-color: #3d9142;
        }

        .check-button 
        {
            background-color: #4CAF50;
            margin-top: 10px;
        }

        .check-button:hover {
            background-color: #45a049;
        }

        #output {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 5px;
            line-height: 1.8;
            font-size: 18px;
            min-height: 100px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .word {
            display: inline-block;
            margin: 0 2px;
        }

        .blank-input {
            display: inline-block;
            border: none;
            border-bottom: 2px solid #333;
            background-color: transparent;
            font-size: 18px;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0 2px;
            padding: 2px 5px;
            min-width: 80px;
            outline: none;
        }

        .blank-input:focus {
            border-bottom: 2px solid #2196F3;
            background-color: #f0f0f0;
        }

        .blank-input.correct {
            background-color: #c8e6c9;
            border-bottom: 2px solid #4CAF50;
        }

        .blank-input.incorrect {
            background-color: #ffcdd2;
            border-bottom: 2px solid #f44336;
        }

        .score-display {
            margin-top: 20px;
            padding: 15px;
            background-color: #e3f2fd;
            border-radius: 5px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            display: none;
        }

        .score-display.show {
            display: block;
        }

        .correct-answer {
            font-size: 14px;
            color: #666;
            display: inline;
            margin-top: 5px;
            font-style: italic;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Text Memorization Helper</h1>

        <div>
            <label for="inputText">Paste your text here:</label>
            <textarea id="inputText" placeholder="Enter the text you want to memorize..."></textarea>
            <button onclick="toggleTextArea()" style="margin-top: 10px;">Hide/Show Text</button>
        </div>

        <div class="controls">
            <div class="mode-toggle">
                <div>
                    <div class="mode-label">Blanking Mode: <span id="modeText">By Word</span></div>
                    <div class="mode-description">Toggle to switch between hiding individual words or entire lines</div>
                </div>
                <div class="toggle-container">
                    <span>Word</span>
                    <div class="toggle-switch" id="modeToggle" onclick="toggleMode()">
                        <div class="toggle-slider"></div>
                    </div>
                    <span>Line</span>
                </div>
            </div>

            <div class="slider-container">
                <label for="visibilitySlider"><span id="sliderLabel">Word</span> Visibility:</label>
                <input type="range" id="visibilitySlider" min="0" max="100" value="50">
                <div class="percentage" id="percentageDisplay">50%</div>
            </div>
            
            <button class="randomize" onclick="randomizeWords()">Randomize Hidden <span id="buttonLabel">Words</span></button>
        </div>
        
        <div id="output"></div>
        <button class="check-button" onclick="checkAnswers()">Check Answers</button>
        <div class="score-display" id="scoreDisplay"></div>
    </div>

    <script>
        let textStructure = [];
        let allWords = [];
        let allLines = [];
        let visibleIndices = new Set();
        let isLineMode = false;
        let inputElements = [];

        // Toggle between word and line mode
        function toggleMode() {
            isLineMode = !isLineMode;
            const toggle = document.getElementById('modeToggle');
            const modeText = document.getElementById('modeText');
            const sliderLabel = document.getElementById('sliderLabel');
            const buttonLabel = document.getElementById('buttonLabel');

            if (isLineMode) {
                toggle.classList.add('active');
                modeText.textContent = 'By Line';
                sliderLabel.textContent = 'Line';
                buttonLabel.textContent = 'Lines';
            } else {
                toggle.classList.remove('active');
                modeText.textContent = 'By Word';
                sliderLabel.textContent = 'Word';
                buttonLabel.textContent = 'Words';
            }

            // Re-parse and display with new mode
            parseText();
        }

        // Parse text and maintain structure with line breaks
        function parseText() {
            const inputText = document.getElementById('inputText').value;
            if (!inputText.trim()) {
                document.getElementById('output').innerHTML = 'Please enter some text above.';
                return;
            }

            // Split text by lines
            const lines = inputText.split('\n');
            textStructure = [];
            allWords = [];
            allLines = [];

            lines.forEach((line, lineIndex) => {
                const lineWords = line.match(/\S+/g) || [];
                const lineData = {
                    words: [],
                    isEmpty: lineWords.length === 0,
                    lineIndex: allLines.length,
                    fullText: line
                };

                // Only add non-empty lines to allLines
                if (!lineData.isEmpty) {
                    allLines.push(line);
                }

                lineWords.forEach(word => {
                    lineData.words.push({
                        text: word,
                        globalIndex: allWords.length
                    });
                    allWords.push(word);
                });

                textStructure.push(lineData);
            });

            // Initialize with random visible items based on slider
            randomizeWords();
        }

        // Update display based on current visibility settings
        function updateDisplay() {
            if (textStructure.length === 0) {
                parseText();
                return;
            }

            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = '';
            inputElements = [];

            // Hide score display when updating
            document.getElementById('scoreDisplay').classList.remove('show');

            textStructure.forEach((lineData, lineIndex) => {
                if (lineData.isEmpty) {
                    // Empty line
                    if (lineIndex > 0) {
                        outputDiv.appendChild(document.createElement('br'));
                    }
                } else {
                    // Line with content
                    if (lineIndex > 0) {
                        outputDiv.appendChild(document.createElement('br'));
                    }

                    if (isLineMode) {
                        // Line mode: treat entire line as one unit
                        if (visibleIndices.has(lineData.lineIndex)) {
                            const span = document.createElement('span');
                            span.className = 'word';
                            span.textContent = lineData.fullText;
                            outputDiv.appendChild(span);
                        } else {
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.className = 'blank-input';
                            input.style.width = '150px';
                            input.dataset.correctAnswer = lineData.fullText;
                            input.placeholder = '...';

                            // Add enter key support to move to next input
                            input.addEventListener('keypress', function (e) {
                                if (e.key === 'Enter') {
                                    const currentIndex = inputElements.indexOf(input);
                                    if (currentIndex < inputElements.length - 1) {
                                        inputElements[currentIndex + 1].focus();
                                    }
                                }
                            });

                            outputDiv.appendChild(input);
                            inputElements.push(input);
                        }
                    } else {
                        // Word mode: handle individual words
                        lineData.words.forEach((wordData, wordIndex) => {
                            if (visibleIndices.has(wordData.globalIndex)) {
                                const span = document.createElement('span');
                                span.className = 'word';
                                span.textContent = wordData.text;
                                outputDiv.appendChild(span);
                            } else {
                                const input = document.createElement('input');
                                input.type = 'text';
                                input.className = 'blank-input';
                                input.style.width = Math.max(wordData.text.length * 10, 80) + 'px';
                                input.dataset.correctAnswer = wordData.text;
                                input.placeholder = '...';

                                // Add enter key support to move to next input
                                input.addEventListener('keypress', function (e) {
                                    if (e.key === 'Enter') {
                                        const currentIndex = inputElements.indexOf(input);
                                        if (currentIndex < inputElements.length - 1) {
                                            inputElements[currentIndex + 1].focus();
                                        }
                                    }
                                });

                                outputDiv.appendChild(input);
                                inputElements.push(input);
                            }
                            // Add space between words (but not after the last word in a line)
                            if (wordIndex < lineData.words.length - 1) {
                                outputDiv.appendChild(document.createTextNode(' '));
                            }
                        });
                    }
                }
            });
        }

        // Calculate edit distance between two strings
            function editDistance(str1, str2) {
                const m = str1.length;
                const n = str2.length;
                const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));

                for (let i = 0; i <= m; i++) dp[i][0] = i;
                for (let j = 0; j <= n; j++) dp[0][j] = j;

                for (let i = 1; i <= m; i++) {
                    for (let j = 1; j <= n; j++) {
                        if (str1[i - 1] === str2[j - 1]) {
                            dp[i][j] = dp[i - 1][j - 1];
                        } else {
                            dp[i][j] = Math.min(dp[i - 1][j], dp[i][j - 1], dp[i - 1][j - 1]) + 1;
                        }
                    }
                }
                return dp[m][n];
            }

        // Check if two strings differ only by one transposed pair of adjacent letters
            function hasTransposedLetters(str1, str2) {
                if (str1.length !== str2.length) return false;

                let differences = [];
                for (let i = 0; i < str1.length; i++) {
                    if (str1[i] !== str2[i]) {
                        differences.push(i);
                    }
                }

                // Check if exactly 2 adjacent positions are different and transposed
                if (differences.length === 2 &&
                    differences[1] - differences[0] === 1 &&
                    str1[differences[0]] === str2[differences[1]] &&
                    str1[differences[1]] === str2[differences[0]]) {
                    return true;
                }
                return false;
            }

        // Check all answers and show results
        function checkAnswers() {
            let correct = 0;
            let total = inputElements.length;
            
            inputElements.forEach(input => {
                const userAnswer = input.value.trim();
                const correctAnswer = input.dataset.correctAnswer;

                // Remove any existing correct answer display (only the one directly after this input)
                let nextElement = input.nextElementSibling;
                if (nextElement && nextElement.classList.contains('correct-answer')) {
                    nextElement.remove();
                }

                // Remove previous styling
                input.classList.remove('correct', 'incorrect');


                if (editDistance(userAnswer.toLowerCase(), correctAnswer.toLowerCase()) <= 1 ||
                    hasTransposedLetters(userAnswer.toLowerCase(), correctAnswer.toLowerCase())) {
                    input.classList.add('correct');
                    correct++;
                } else {
                    input.classList.add('incorrect');

                    // Show the correct answer next to the input
                    if (userAnswer !== '') {
                        const answerDisplay = document.createElement('span');
                        answerDisplay.className = 'correct-answer';
                        answerDisplay.textContent = `Correct: ${correctAnswer}`;
                        input.parentNode.insertBefore(answerDisplay, input.nextSibling);
                    }
                }
            });

            // Display score
            const scoreDisplay = document.getElementById('scoreDisplay');
            const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;

            let scoreMessage = `Score: ${correct}/${total} (${percentage}%)`;
            if (percentage === 100) {
                scoreMessage += ' ðŸŽ‰ Perfect!';
            } else if (percentage >= 80) {
                scoreMessage += ' ðŸ‘ Great job!';
            } else if (percentage >= 60) {
                scoreMessage += ' ðŸ‘ Good effort!';
            } else {
                scoreMessage += ' ðŸ’ª Keep practicing!';
            }

            scoreDisplay.textContent = scoreMessage;
            scoreDisplay.classList.add('show');
        }

        // Randomize which words/lines are visible based on percentage
        function randomizeWords() {
            const items = isLineMode ? allLines : allWords;

            if (items.length === 0) {
                parseText();
                return;
            }

            if (items.length === 0) return;

            const visibilityPercentage = document.getElementById('visibilitySlider').value;
            const numVisible = Math.round((visibilityPercentage / 100) * items.length);

            // Create array of all indices
            const allIndices = Array.from({ length: items.length }, (_, i) => i);

            // Shuffle array
            for (let i = allIndices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allIndices[i], allIndices[j]] = [allIndices[j], allIndices[i]];
            }

            // Select first numVisible indices
            visibleIndices = new Set(allIndices.slice(0, numVisible));

            updateDisplay();
        }

        // Handle slider change
        document.getElementById('visibilitySlider').addEventListener('input', function (e) {
            const percentage = e.target.value;
            document.getElementById('percentageDisplay').textContent = percentage + '%';

            const items = isLineMode ? allLines : allWords;
            const numVisible = Math.round((percentage / 100) * items.length);

            // If we need to show more items, add random hidden items
            if (numVisible > visibleIndices.size) {
                const hiddenIndices = [];
                for (let i = 0; i < items.length; i++) {
                    if (!visibleIndices.has(i)) {
                        hiddenIndices.push(i);
                    }
                }

                // Shuffle hidden indices
                for (let i = hiddenIndices.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [hiddenIndices[i], hiddenIndices[j]] = [hiddenIndices[j], hiddenIndices[i]];
                }

                // Add needed number of items
                const toAdd = numVisible - visibleIndices.size;
                for (let i = 0; i < toAdd && i < hiddenIndices.length; i++) {
                    visibleIndices.add(hiddenIndices[i]);
                }
            }
            // If we need to hide items, remove random visible items
            else if (numVisible < visibleIndices.size) {
                const visibleArray = Array.from(visibleIndices);

                // Shuffle visible indices
                for (let i = visibleArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [visibleArray[i], visibleArray[j]] = [visibleArray[j], visibleArray[i]];
                }

                // Remove needed number of items
                const toRemove = visibleIndices.size - numVisible;
                for (let i = 0; i < toRemove; i++) {
                    visibleIndices.delete(visibleArray[i]);
                }
            }

            updateDisplay();
        });

        // Handle text input change
        document.getElementById('inputText').addEventListener('input', function () {
            parseText();
        });

        // Initial setup
        document.addEventListener('DOMContentLoaded', function () {
            parseText();
        });

        // Toggle visibility of the input text area
            function toggleTextArea() {
                const textarea = document.getElementById('inputText');
                const label = textarea.previousElementSibling;
                const button = event.target;

                if (textarea.style.display === 'none') {
                    textarea.style.display = 'block';
                    label.style.display = 'block';
                    button.textContent = 'Hide Text';
                } else {
                    textarea.style.display = 'none';
                    label.style.display = 'none';
                    button.textContent = 'Show Text';
                }
            }
    </script>
</body>

</html>